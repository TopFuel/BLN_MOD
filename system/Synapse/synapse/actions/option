bln() {
	if [[ ! -z $2 ]]; then
		case $2 in
		Steady)
			echo "0" > /sys/class/misc/notification/breathing
			echo "reset" > /sys/class/misc/notification/breathing_steps
			;;
		Dimmed)
			echo "1" > /sys/class/misc/notification/breathing
			echo "reset" > /sys/class/misc/notification/breathing_steps
			echo "2600 2600 20000 0" > /sys/class/misc/notification/breathing_steps
			;;
		Breathing)
			echo "1" > /sys/class/misc/notification/breathing
			echo "reset" > /sys/class/misc/notification/breathing_steps
			echo "2600 3300 70 50" > /sys/class/misc/notification/breathing_steps
			echo "3300 2600 70 50" > /sys/class/misc/notification/breathing_steps
			;;
		Blinking)
			echo "1" > /sys/class/misc/notification/breathing
			echo "reset" > /sys/class/misc/notification/breathing_steps
			echo "2500 2500 1000 100" > /sys/class/misc/notification/breathing_steps
			echo "3300 3300 1000 100" > /sys/class/misc/notification/breathing_steps
			;;
		Orgasm)
			echo "1" > /sys/class/misc/notification/breathing
			echo "reset" > /sys/class/misc/notification/breathing_steps
			echo "2500 2700 90 50" > /sys/class/misc/notification/breathing_steps
			echo "2700 2500 90 50" > /sys/class/misc/notification/breathing_steps
			echo "2700 2900 80 50" > /sys/class/misc/notification/breathing_steps
			echo "2900 2700 80 50" > /sys/class/misc/notification/breathing_steps
			echo "2900 3100 70 50" > /sys/class/misc/notification/breathing_steps
			echo "3100 2900 70 50" > /sys/class/misc/notification/breathing_steps
			echo "3100 3300 50 50" > /sys/class/misc/notification/breathing_steps
			echo "3300 3300 100 50" > /sys/class/misc/notification/breathing_steps
			echo "3300 2400 50 50" > /sys/class/misc/notification/breathing_steps
			echo "2400 2400 100 10" > /sys/class/misc/notification/breathing_steps
			;;
		esac
	fi
	bNewStepsCount=`grep -oEc "^[0-9]{1,4}mV" /sys/class/misc/notification/breathing_steps`
	if grep -q 0 /sys/class/misc/notification/breathing ; then
		echo Steady
	elif [ "$bNewStepsCount" = "10" ] ; then
		echo Orgasm	
	elif grep -q "ms 0mV" /sys/class/misc/notification/breathing_steps ; then
		echo Dimmed
	elif grep -q "ms 50mV" /sys/class/misc/notification/breathing_steps ; then
		echo Breathing
	elif grep -q "ms 100mV" /sys/class/misc/notification/breathing_steps ; then
		echo Blinking
	fi
}

minVoltage() {
	case $1 in
		Steady)
			bVoltage=`grep -oE "[0-9]{1,4}mV" /sys/class/misc/notification/breathing_steps | grep -n "mV" | grep "1:" | grep -oE "[0-9]{2,4}"`
			echo $bVoltage
		;;
		Dimmed)
			if [[ ! -z $2 ]]; then
				if grep -q 1 /sys/class/misc/notification/breathing ; then
					echo "reset" > /sys/class/misc/notification/breathing_steps
					if [ "$2" = "2500" ] ; then
						echo "2550 2550 20000 0" > /sys/class/misc/notification/breathing_steps
					else
						echo "$2 $2 20000 0" > /sys/class/misc/notification/breathing_steps
					fi
				fi
			fi
			bVoltage=`grep -oE "[0-9]{1,4}mV" /sys/class/misc/notification/breathing_steps | grep -n "mV" | grep "1:" | grep -oE "[0-9]{2,4}"`
			echo $bVoltage
		;;
		Breathing)
			if [[ ! -z $2 ]]; then
				if grep -q 1 /sys/class/misc/notification/breathing ; then
					echo "reset" > /sys/class/misc/notification/breathing_steps
					echo "$2 $bOldVoltageMax $bOldStepLength 50" > /sys/class/misc/notification/breathing_steps
					echo "$bOldVoltageMax $2 $bOldStepLength 50" > /sys/class/misc/notification/breathing_steps
				fi
			fi
			bVoltage=`grep -oE "[0-9]{1,4}mV" /sys/class/misc/notification/breathing_steps | grep -n "mV" | grep "1:" | grep -oE "[0-9]{2,4}"`
			echo $bVoltage
		;;
		Blinking)
			if [[ ! -z $2 ]]; then
				if grep -q 1 /sys/class/misc/notification/breathing ; then
					echo "reset" > /sys/class/misc/notification/breathing_steps
					echo "$2 $2 $bOldStepLength 100" > /sys/class/misc/notification/breathing_steps
					echo "$bOldVoltageMax $bOldVoltageMax $bOldStepLength 100" > /sys/class/misc/notification/breathing_steps
				fi
			fi
			bVoltage=`grep -oE "[0-9]{1,4}mV" /sys/class/misc/notification/breathing_steps | grep -n "mV" | grep "1:" | grep -oE "[0-9]{2,4}"`
			echo $bVoltage
		;;
		Orgasm)
			echo 2500
		;;
	esac
}
maxVoltage() {
	case $1 in
		Steady)
			bVoltage=`grep -oE "[0-9]{1,4}mV" /sys/class/misc/notification/breathing_steps | grep -n "mV" | grep "2:" | grep -oE "[0-9]{2,4}"`
			echo $bVoltage
		;;
		Dimmed)
			bVoltage=`grep -oE "[0-9]{1,4}mV" /sys/class/misc/notification/breathing_steps | grep -n "mV" | grep "2:" | grep -oE "[0-9]{2,4}"`
			echo $bVoltage
		;;
		Breathing)
			if [[ ! -z $2 ]]; then
				if grep -q 1 /sys/class/misc/notification/breathing ; then
					echo "reset" > /sys/class/misc/notification/breathing_steps
					echo "$bOldVoltageMin $2 $bOldStepLength 50" > /sys/class/misc/notification/breathing_steps
					echo "$2 $bOldVoltageMin $bOldStepLength 50" > /sys/class/misc/notification/breathing_steps
				fi
			fi
			bVoltage=`grep -oE "[0-9]{1,4}mV" /sys/class/misc/notification/breathing_steps | grep -n "mV" | grep "2:" | grep -oE "[0-9]{2,4}"`
			echo $bVoltage
		;;
		Blinking)
			if [[ ! -z $2 ]]; then
				if grep -q 1 /sys/class/misc/notification/breathing ; then
					echo "reset" > /sys/class/misc/notification/breathing_steps
					echo "$bOldVoltageMin $bOldVoltageMin $bOldStepLength 100" > /sys/class/misc/notification/breathing_steps
					echo "$2 $2 $bOldStepLength 100" > /sys/class/misc/notification/breathing_steps
				fi
			fi
			bVoltage=`grep -oE "[0-9]{1,4}mV" /sys/class/misc/notification/breathing_steps | grep -n "mV" | grep "5:" | grep -oE "[0-9]{2,4}"`
			echo $bVoltage
		;;
		Orgasm)
			echo 3300
		;;
	esac
}
steplength() {
	case $mode in
		Steady)
			bStepLength=`grep -oE "[0-9]{1,5}ms" /sys/class/misc/notification/breathing_steps | grep -n "ms" | grep "1:" | grep -oE "[0-9]{2,5}"`
			echo $bStepLength
		;;
		Dimmed)
			bStepLength=`grep -oE "[0-9]{1,5}ms" /sys/class/misc/notification/breathing_steps | grep -n "ms" | grep "1:" | grep -oE "[0-9]{2,5}"`
			echo $bStepLength
		;;
		Breathing)
			if [[ ! -z $1 ]]; then
				echo "reset" > /sys/class/misc/notification/breathing_steps
				echo "$bOldVoltageMin $bOldVoltageMax $1 50" > /sys/class/misc/notification/breathing_steps
				echo "$bOldVoltageMax $bOldVoltageMin $1 50" > /sys/class/misc/notification/breathing_steps
			fi
			bStepLength=`grep -oE "[0-9]{1,5}ms" /sys/class/misc/notification/breathing_steps | grep -n "ms" | grep "1:" | grep -oE "[0-9]{2,5}"`
			echo $bStepLength
		;;
		Blinking)
			if [[ ! -z $1 ]]; then
				echo "reset" > /sys/class/misc/notification/breathing_steps
				echo "$bOldVoltageMin $bOldVoltageMin $1 100" > /sys/class/misc/notification/breathing_steps
				echo "$bOldVoltageMax $bOldVoltageMax $1 100" > /sys/class/misc/notification/breathing_steps
			fi
			bStepLength=`grep -oE "[0-9]{1,5}ms" /sys/class/misc/notification/breathing_steps | grep -n "ms" | grep "1:" | grep -oE "[0-9]{2,5}"`
			echo $bStepLength
		;;
		Orgasm)
			echo 70
		;;
	esac	
}


bStepsCount=`grep -oEc "^[0-9]{1,4}mV" /sys/class/misc/notification/breathing_steps`
bOldVoltageStart=`grep -oE "[0-9]{1,4}mV" /sys/class/misc/notification/breathing_steps | grep -n "mV" | grep "1:" | grep -oE "[0-9]{2,4}"`
bOldVoltageEnd=`grep -oE "[0-9]{1,4}mV" /sys/class/misc/notification/breathing_steps | grep -n "mV" | grep "2:" | grep -oE "[0-9]{2,4}"`
bOldVoltageSteps=`grep -oE "[0-9]{1,4}mV" /sys/class/misc/notification/breathing_steps | grep -n "mV" | grep "3:" | grep -oE "[0-9]{1,4}"`
bOldStepLength=`grep -oE "[0-9]{1,5}ms" /sys/class/misc/notification/breathing_steps | grep -n "ms" | grep "1:" | grep -oE "[0-9]{2,5}"`
bBreathing=`grep -E "[0,1]" /sys/class/misc/notification/breathing`
bBlnActive=`grep -E "[0,1]" /sys/class/misc/notification/notification_enabled`

if [ "$bBreathing" = "0" ]; then
	mode=Steady
elif [ "$bStepsCount" = "10" ] ; then
	mode=Orgasm
elif grep -q "20000ms 0mV" /sys/class/misc/notification/breathing_steps ; then
	mode=Dimmed
elif grep -q "ms 50mV" /sys/class/misc/notification/breathing_steps ; then
	mode=Breathing
elif grep -q "ms 100mV" /sys/class/misc/notification/breathing_steps ; then
	mode=Blinking
fi
bOldVoltageMax=`grep -oE "[0-9]{1,4}m[V|s]" /sys/class/misc/notification/breathing_steps | grep -n "mV" | grep "[1|2|5|6]:" | grep -oE "[0-9]{2,4}"| sort -r | grep -nE "[0-9]{2,4}" |grep -oE "1:[0-9]{2,4}" | grep -oE "[0-9]{2,4}"`
bOldVoltageMin=`grep -oE "[0-9]{1,4}m[V|s]" /sys/class/misc/notification/breathing_steps | grep -n "mV" | grep "[1|2|5|6]:" | grep -oE "[0-9]{2,4}"| sort | grep -nE "[0-9]{2,4}" |grep -oE "1:[0-9]{2,4}" | grep -oE "[0-9]{2,4}"`

case $1 in
	blneffect)
		if [[ ! -z $2 ]]; then
				bln $1 $2
			else
				bln $1
			fi
	;;
	minVoltage)
		if [[ ! -z $2 ]]; then
			minVoltage $mode $2
		else
			if grep -q 1 /sys/class/misc/notification/breathing ; then
				minVoltage $mode
			else
				minVoltage $mode
			fi
		fi
	;;
	maxVoltage)
		if [[ ! -z $2 ]]; then
			maxVoltage $mode $2
		else
			if grep -q 1 /sys/class/misc/notification/breathing ; then
				maxVoltage $mode
			else
				maxVoltage $mode
			fi
		fi
	;;
	steplength)
		if [[ ! -z $2 ]]; then
			steplength $2
		else
			steplength
		fi
	;;
	toggleLEDs)
		if [ "$bBlnActive" = "1" ]; then
			if grep -q 1 /sys/class/misc/notification/led ; then
				echo 0 > /sys/class/misc/notification/led
				echo LEDs OFF
			else
				echo 1 > /sys/class/misc/notification/led
				echo LEDs ON
			fi
		else
			echo ACTIVATE BLN FIRST
		fi
	;;
	debug)
		echo bBlnActive: $bBlnActive
		echo bStepsCount: $bStepsCount
		echo bOldVoltageStart: $bOldVoltageStart
		echo bOldVoltageEnd: $bOldVoltageEnd
		echo bOldStepLength: $bOldStepLength
		echo bOldVoltageSteps: $bOldVoltageSteps
		echo bOldVoltageMax: $bOldVoltageMax
		echo bOldVoltageMin: $bOldVoltageMin
		echo bBreathing: $bBreathing
		echo mode: $mode
	;;
esac
